以下是适合直接复制的 Markdown 格式详细需求说明书：

---

# 客户拜访管理系统 需求说明书

---

## 一、项目目标

开发一套适用于企业销售团队的客户拜访管理系统，实现拜访计划、记录、反馈、统计等全流程信息化管理，支持多角色权限、数据分级、界面美观、易用、易维护。

---

## 二、用户角色与权限

**管理员（admin）**
- 拥有所有用户和拜访数据的管理权限
- 可激活/禁用用户、重置密码、设置用户上级
- 可对所有拜访记录进行反馈

**普通用户（user）**
- 仅可操作本人及下属的拜访数据
- 可新建、编辑、删除、提交自己的拜访记录
- 可对下属提交的拜访记录进行反馈

---

## 三、主要功能模块

### 1. 用户与权限管理

- 用户注册、登录、修改密码、登出
- 用户状态管理（激活/禁用/待审核）
- 管理员可重置用户密码
- 管理员可设置/取消用户上级，自动校验避免环状关系

### 2. 拜访记录管理

- 新建拜访（标题、客户、计划日期、描述）
- 编辑/删除拜访（仅本人草稿可操作）
- 提交拜访（草稿提交后不可再编辑/删除）
- 拜访反馈（上级或管理员对“已提交”拜访填写反馈，状态变为“已反馈”）
- 拜访列表支持按状态、用户筛选，支持分页
- 拜访状态统计（草稿、已提交、已反馈数量）

### 3. 数据统计与分析

- 拜访状态统计（按用户/全员）
- 支持多条件查询与分页

### 4. 安全与数据保护

- 密码加密存储
- API 鉴权采用 JWT
- 敏感操作需鉴权
- 仅管理员可进行用户管理相关操作

---

## 四、数据结构设计

### 1. 用户表（users.db）

| 字段        | 类型    | 说明           |
| ----------- | ------- | -------------- |
| _id         | string  | 主键，UUID     |
| username    | string  | 用户名         |
| password    | string  | 密码哈希       |
| role        | string  | 用户角色（admin/user） |
| status      | string  | 状态（pending/active/disabled） |
| superiorId  | string  | 上级用户ID，可为空 |

### 2. 拜访记录表（visits.db）

| 字段        | 类型    | 说明               |
| ----------- | ------- | ------------------ |
| _id         | string  | 主键，UUID         |
| title       | string  | 拜访标题           |
| customer    | string  | 客户名称           |
| planDate    | string  | 计划拜访日期（ISO）|
| desc        | string  | 拜访描述           |
| status      | string  | 状态（draft/submitted/feedback） |
| feedback    | string  | 反馈内容           |
| creator     | string  | 创建人ID           |
| createdAt   | number  | 创建时间戳         |

---

## 五、接口设计（RESTful）

- `POST   /api/register`       用户注册
- `POST   /api/login`          用户登录
- `POST   /api/change-pw`      修改当前密码
- `GET    /api/me`             获取当前用户信息
- `GET    /api/users`          获取所有普通用户（仅管理员）
- `POST   /api/users/status`   激活/禁用用户（仅管理员）
- `POST   /api/users/resetpw`  重置用户密码（仅管理员）
- `POST   /api/users/superior` 设置/取消上级（仅管理员）
- `POST   /api/visits`         新建拜访
- `GET    /api/visits`         拜访列表查询（支持筛选、分页）
- `GET    /api/visits/stat`    拜访统计（当前用户/全员）
- `GET    /api/visits/:id`     获取拜访详情
- `POST   /api/visits/:id/edit` 编辑拜访（仅本人草稿）
- `POST   /api/visits/:id/delete` 删除拜访（仅本人草稿）
- `POST   /api/visits/:id/submit` 提交拜访（仅本人草稿）
- `POST   /api/visits/:id/feedback` 添加反馈（上级/管理员）

---

## 六、前端UI设计

### 1. 登录/注册页

- 居中卡片式表单，包含用户名、密码输入框
- 支持新用户注册弹窗
- 登录成功后跳转主应用页面

### 2. 主应用页面（app.html）

- 顶部导航栏：系统名称、当前用户、修改密码、退出登录
- 左侧导航：拜访记录、用户管理（仅管理员可见）
- 主体区域：分为拜访管理、用户管理两个 Tab

#### 拜访管理

- 工具栏：新建拜访、状态筛选、用户筛选（管理员/上级可见）、状态统计
- 拜访列表：表格展示，含标题、客户、计划日期、状态、创建者、操作
- 操作按钮：详情、编辑、删除、提交、反馈（根据权限和状态动态显示）
- 分页控件

#### 用户管理（仅管理员）

- 用户列表：表格展示用户名、角色、状态、上级ID、操作
- 操作按钮：激活/禁用、重置密码、设置上级

#### 弹窗

- 使用 SweetAlert2 弹窗进行表单输入、确认、提示等
- 表单项有必要的校验和提示

### 3. 响应式设计

- 支持移动端自适应，主要布局和按钮在小屏下自动调整

### 4. 视觉风格

- 现代卡片风格，主色调绿色+深色背景
- 使用 FontAwesome 图标
- 统一按钮、表格、弹窗样式
- 交互友好，操作有反馈

---

## 七、技术栈

- 前端：原生 HTML5、CSS3、JavaScript（无框架）、FontAwesome、SweetAlert2
- 后端：Node.js、Express
- 数据库：NeDB（嵌入式，无需独立部署）
- 鉴权：JWT
- 密码加密：bcryptjs
- 其他依赖：uuid

---

## 八、部署与运行

1. 克隆代码仓库
2. 安装依赖：`npm install`
3. 配置环境变量（端口、JWT密钥、管理员账号密码）
4. 启动服务：`node server.js`
5. 浏览器访问 `http://localhost:3000`

---

## 九、其他说明

- 代码结构清晰，易于维护和扩展
- 支持后续对接关系型数据库或云端服务
- 可根据实际需求扩展拜访字段或用户属性

---

> 如需插入系统界面示意图，可在 Markdown 里用 `!图片说明` 或粘贴截图补充。