# 客户拜访管理系统

## 项目简介

客户拜访管理系统为企业提供低成本、高效、易用的客户拜访记录与管理解决方案，适用于销售团队对客户拜访过程的计划、记录、追踪、反馈及统计分析。

---

## 1. 需求规格说明书

### 1.1 系统目标

构建一套支持多角色（管理员/普通用户）、权限分级、可扩展的客户拜访管理系统，实现客户拜访全流程的信息化、标准化管理。

### 1.2 功能需求

#### 1.2.1 用户与权限管理
- 支持用户注册、登录、修改密码、退出登录。
- 支持用户状态管理（激活/禁用/待审核）。
- 管理员拥有所有用户和拜访数据的管理权限。
- 普通用户仅可操作本人及下属的数据。
- 支持为用户分配上级，形成汇报关系链，防止循环引用。

#### 1.2.2 拜访记录管理
- 支持新建、编辑、删除、提交拜访记录。
- 拜访记录包含：标题、客户名称、计划拜访日期、拜访描述、状态（草稿/已提交/已反馈）、反馈信息、创建人、创建时间。
- 支持拜访记录的多状态流转，管理员和上级可对“已提交”记录进行反馈。
- 支持拜访记录列表的筛选（按状态、用户）、分页与统计。

#### 1.2.3 数据统计与分析
- 支持拜访记录状态统计（草稿、已提交、已反馈）。
- 支持分页和多条件查询。

#### 1.2.4 安全与数据保护
- 用户密码加密存储。
- API 鉴权采用 JWT，敏感操作需鉴权。
- 仅管理员可进行用户管理、重置密码等操作。

### 1.3 非功能需求

- 操作界面简洁美观，支持响应式布局。
- 部署简单，无需依赖外部数据库。
- 具备良好的代码可维护性与可扩展性。

### 1.4 技术架构

- 前端：原生 HTML5、CSS3、JavaScript（无框架依赖）、FontAwesome、SweetAlert2
- 后端：Node.js + Express
- 数据库：NeDB（嵌入式，无需独立部署）
- 认证：JWT
- 其它：bcryptjs（密码加密）、uuid

---

## 2. 功能模块详解

### 2.1 用户管理

- **注册**：填写用户名和密码注册（密码不少于6位），默认状态为“待审核”。
- **登录**：用户名+密码登录，登录成功获得 JWT token。
- **修改密码**：输入当前密码和新密码，校验后修改。
- **用户状态管理**（管理员）：激活/禁用用户账号。
- **重置密码**（管理员）：为指定用户重置密码。
- **设置上级**（管理员）：为用户指定/取消上级，自动校验避免环状汇报关系。

### 2.2 拜访管理

- **新建拜访**：填写标题、客户、计划拜访日期、描述，保存为草稿。
- **编辑拜访**：仅本人草稿可编辑。
- **删除拜访**：仅本人草稿可删除。
- **提交拜访**：草稿提交后状态为“已提交”，待上级或管理员反馈。
- **反馈拜访**：上级或管理员对“已提交”记录添加反馈，记录状态变为“已反馈”。
- **拜访筛选与统计**：支持按用户、状态筛选，支持分页。显示拜访记录各状态数量。
- **拜访列表与详情**：可查看拜访明细，包括反馈内容与操作者信息。

### 2.3 安全与系统

- **鉴权**：所有接口需携带有效 JWT。
- **密码安全**：所有密码加密存储。
- **权限校验**：所有操作根据用户角色和数据归属严格控制。

---

## 3. 接口一览（RESTful）

- `POST   /api/register`       用户注册
- `POST   /api/login`          用户登录
- `POST   /api/change-pw`      修改当前密码
- `GET    /api/me`             获取当前用户信息
- `GET    /api/users`          获取所有普通用户（仅管理员）
- `POST   /api/users/status`   激活/禁用用户（仅管理员）
- `POST   /api/users/resetpw`  重置用户密码（仅管理员）
- `POST   /api/users/superior` 设置/取消上级（仅管理员）
- `POST   /api/visits`         新建拜访
- `GET    /api/visits`         拜访列表查询（支持筛选、分页）
- `GET    /api/visits/stat`    拜访统计（当前用户/全员）
- `GET    /api/visits/:id`     获取拜访详情
- `POST   /api/visits/:id/edit` 编辑拜访（仅本人草稿）
- `POST   /api/visits/:id/delete` 删除拜访（仅本人草稿）
- `POST   /api/visits/:id/submit` 提交拜访（仅本人草稿）
- `POST   /api/visits/:id/feedback` 添加反馈（上级/管理员）

---

## 4. 数据结构设计

### 4.1 用户表（users.db）

| 字段        | 类型    | 说明           |
| ----------- | ------- | -------------- |
| _id         | string  | 主键，UUID     |
| username    | string  | 用户名         |
| password    | string  | 密码哈希       |
| role        | string  | 用户角色（admin/user） |
| status      | string  | 状态(pending/active/disabled) |
| superiorId  | string  | 上级用户ID，可空 |

### 4.2 拜访记录表（visits.db）

| 字段        | 类型    | 说明               |
| ----------- | ------- | ------------------ |
| _id         | string  | 主键，UUID         |
| title       | string  | 拜访标题           |
| customer    | string  | 客户名称           |
| planDate    | string  | 计划拜访日期（ISO）|
| desc        | string  | 拜访描述           |
| status      | string  | 状态(draft/submitted/feedback) |
| feedback    | string  | 反馈内容           |
| creator     | string  | 创建人ID           |
| createdAt   | number  | 创建时间戳         |

---

## 5. 安装与运行

1. 克隆仓库
   ```bash
   git clone https://github.com/CNKM/customer-visit-management-system.git
   cd customer-visit-management-system
   ```
2. 安装依赖
   ```bash
   npm install
   ```
3. 配置环境变量（可选，参考 `.env.example` 或如下）
   ```
   PORT=3000
   JWT_SECRET=your_jwt_secret
   ADMIN_USERNAME=admin
   ADMIN_PASSWORD=admin123
   ```
4. 启动服务
   ```bash
   node server.js
   ```
5. 浏览器访问 `http://localhost:3000`

---

## 6. 用例说明

### 6.1 用户注册与登录

- 新用户注册后需管理员激活方可登录。
- 管理员可在“用户管理”界面激活/禁用账号。

### 6.2 拜访流程

1. 用户新建拜访（草稿）
2. 填写完整后点“提交”，状态变为“已提交”
3. 上级/管理员审核后填写反馈，状态变为“已反馈”
4. 用户可随时查看拜访详情与反馈

### 6.3 用户管理流程

- 管理员可重置用户密码、设置用户上级、管理账号状态。

---

## 7. 系统界面示意

- 登录页：输入用户名密码，支持注册新账号。
- 主页面包含顶部导航（拜访记录、用户管理、修改密码），主体为数据卡片+操作按钮+分页控件。
- 拜访记录表格可按状态/用户筛选，并显示各状态统计。
- 用户管理界面支持一键激活/禁用/重置密码/设置上级。

---

## 8. 开发与扩展建议

- 可根据实际需求扩展拜访记录字段或用户属性。
- 如需引入关系型数据库，可替换 NeDB 为 MongoDB/PostgreSQL，并做适配。
- 如需支持移动端，可增加 PWA 支持或开发小程序端。

---

## 9. License

MIT

---

> © 2025 客户拜访管理系统